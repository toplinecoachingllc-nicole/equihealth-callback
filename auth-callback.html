<!DOCTYPE html>
<html>
<head>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const { createClient } = supabase;
    const supabase = createClient('https://ziuboebkkhpelglgjdqj.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InppdWJvZWJra2hwZWxnbGdqZHFqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk0ODM1OTIsImV4cCI6MjA3NTA1OTU5Mn0.mUQ_zS1faOwps0AtJQdIjDAoVFqbUpX8pFZJP7s9gGE');

    window.onload = async () => {
      const urlParams = new URLSearchParams(window.location.search);
      const token = urlParams.get('token');
      const type = urlParams.get('type');

      if (token) {
        try {
          const { data, error } = await supabase.auth.getSession(); // Use getSession with token
          if (!error && data.session) {
            window.location.href = 'equihealth102://login';
          } else {
            console.error('Error getting session:', error);
            window.location.href = 'https://equihealth.net';
          }
        } catch (error) {
          console.error('Unexpected error:', error);
          window.location.href = 'https://equihealth.net';
        }
      } else {
        window.location.href = 'https://equihealth.net';
      }
    };
  </script>
</head>
<body>
  <p>Processing your request...</p>
</body>
</html>
